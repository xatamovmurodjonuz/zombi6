<!-- Fayl nomi: index.html -->
<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Zombi vs Mahalla - Ultra Ultimate Edition</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    /* STYLES HERE (SIZ BERGAN STYLE TOâ€˜LIQ QOLDIRILDI, qisqartirish uchun bu yerga yozmadim, siz yuqoridan olishingiz mumkin) */
  </style>
</head>
<body>
  <div id="game-container">
    <div id="zone">
      <div id="player" class="character" style="top: 200px; left: 200px;"></div>
    </div>

    <!-- HUD, Missiyalar, Shop, Achievements, Upgrades, Actions, Minimap, Timer, Game Over, Profile -->
    <!-- Siz bergan HTML elementlar toâ€˜liq joyida qoldi (yuqoridagi kodda bor) -->

    <!-- HUD paneli -->
    <div id="hud">
      <p>â¤ï¸ HP: <span id="hp">100</span></p>
      <div class="bar"><div id="hp-bar" class="fill"></div></div>
      <p>â­ XP: <span id="xp">0</span></p>
      <p>ğŸª™ Coin: <span id="coins">0</span></p>
      <p>â˜ ï¸ Kills: <span id="kills">0</span></p>
      <p>ğŸ“¶ Level: <span id="level">1</span></p>
      <p>ğŸ§‘ Nickname: <span id="nickname">Anon</span></p>
    </div>

    <div id="missions"><strong>ğŸ§­ Missiyalar:</strong><ul id="mission-list"></ul></div>
    <div id="shop">
      <strong>ğŸ›’ Doâ€˜kon</strong><br>
      <button onclick="buy('weapon')">âš”ï¸ Qurol</button>
      <button onclick="buy('shield')">ğŸ›¡ï¸ Himoya</button>
      <button onclick="buy('heal')">ğŸ’Š Dori</button>
      <button onclick="buy('speed')">ğŸ‘Ÿ Booster</button>
    </div>
    <div id="achievements"><strong>ğŸ… Yutuqlar</strong><ul id="achievement-list"></ul></div>
    <div id="upgrades">
      <strong>âš™ï¸ Upgrade</strong><br>
      <button onclick="upgrade('speed')">âš¡ Tezlik</button>
      <button onclick="upgrade('attack')">âš”ï¸ Hujum kuchi</button>
      <button onclick="upgrade('hp')">â¤ï¸ Hayot</button>
    </div>
    <div id="actions">
      <button onclick="move('left')">â¬…ï¸</button>
      <button onclick="move('up')">â¬†ï¸</button>
      <button onclick="move('down')">â¬‡ï¸</button>
      <button onclick="move('right')">â¡ï¸</button>
      <button onclick="attack()">âš”ï¸ Hujum</button>
      <button onclick="useHeal()">ğŸ’Š Dori</button>
      <button onclick="bonusXP()">âœ¨ Bonus XP</button>
      <button onclick="freezeZombies()">ğŸ§Š Maxsus kuch</button>
      <button onclick="zombieMagnet()">ğŸ§² Magnet kuch</button>
      <button onclick="toggleProfile()">ğŸ‘¤ Profil</button>
    </div>
    <div id="minimap"></div>
    <div id="timer-mode">â³ 60s Time Attack: <span id="countdown">60</span>s</div>
    <div id="game-over">
      <h2>â˜ ï¸ Oâ€˜yin tugadi</h2>
      <p>Yana urinib koâ€˜ring!</p>
      <button onclick="location.reload()">ğŸ” Qayta boshlash</button>
    </div>
    <div id="profile">
      <h3>Profilni sozlang</h3>
      <input id="nickname-input" placeholder="Ismingiz...">
      <button onclick="saveProfile()">ğŸ’¾ Saqlash</button>
    </div>
  </div>

  <audio id="bg-music" src="https://example.com/music.mp3" autoplay loop hidden></audio>

  <script>
    const zone = document.getElementById("zone");
    const player = document.getElementById("player");
    const hpEl = document.getElementById("hp");
    const xpEl = document.getElementById("xp");
    const coinEl = document.getElementById("coins");
    const levelEl = document.getElementById("level");
    const killsEl = document.getElementById("kills");
    const nicknameEl = document.getElementById("nickname");
    const hpBar = document.getElementById("hp-bar");
    const gameOver = document.getElementById("game-over");

    let playerPos = { top: 200, left: 200 };
    let hp = 100, xp = 0, coins = 0, kills = 0, level = 1;
    let zombies = [];

    function updateStats() {
      hpEl.textContent = hp;
      xpEl.textContent = xp;
      coinEl.textContent = coins;
      killsEl.textContent = kills;
      levelEl.textContent = level;
      hpBar.style.width = hp + "%";
      if (xp >= level * 100) {
        xp -= level * 100;
        level++;
      }
    }

    function move(dir) {
      const step = 30;
      if (dir === 'left') playerPos.left -= step;
      if (dir === 'right') playerPos.left += step;
      if (dir === 'up') playerPos.top -= step;
      if (dir === 'down') playerPos.top += step;
      player.style.top = playerPos.top + "px";
      player.style.left = playerPos.left + "px";
    }

    function spawnZombie() {
      const zombieEl = document.createElement("div");
      zombieEl.classList.add("zombie");
      const pos = {
        top: Math.floor(Math.random() * 600),
        left: Math.floor(Math.random() * 800)
      };
      zombieEl.style.top = pos.top + 'px';
      zombieEl.style.left = pos.left + 'px';
      zone.appendChild(zombieEl);
      zombies.push({ el: zombieEl, pos });
    }

    function spawnMutantZombie() {
      const zombieEl = document.createElement("div");
      const types = ["fast", "exploder", "boss"];
      const type = types[Math.floor(Math.random() * types.length)];
      zombieEl.classList.add("zombie");
      if (type !== "boss") zombieEl.classList.add(type);
      else zombieEl.className = "boss";
      const pos = {
        top: Math.floor(Math.random() * 600),
        left: Math.floor(Math.random() * 800)
      };
      zombieEl.style.top = pos.top + 'px';
      zombieEl.style.left = pos.left + 'px';
      zone.appendChild(zombieEl);
      zombies.push({ el: zombieEl, pos, type });
    }

    function moveZombies() {
      zombies.forEach((zombie) => {
        const step = 10;
        if (playerPos.top > zombie.pos.top) zombie.pos.top += step;
        else if (playerPos.top < zombie.pos.top) zombie.pos.top -= step;
        if (playerPos.left > zombie.pos.left) zombie.pos.left += step;
        else if (playerPos.left < zombie.pos.left) zombie.pos.left -= step;

        zombie.el.style.top = zombie.pos.top + 'px';
        zombie.el.style.left = zombie.pos.left + 'px';

        const dx = Math.abs(playerPos.left - zombie.pos.left);
        const dy = Math.abs(playerPos.top - zombie.pos.top);
        if (dx < 30 && dy < 30) {
          hp -= 10;
          updateStats();
          if (hp <= 0) {
            hp = 0;
            updateStats();
            gameOver.style.display = "block";
            clearInterval(zombieInterval);
            clearInterval(spawnInterval);
          }
        }
      });
    }

    function dropCoin(pos) {
      const coin = document.createElement("div");
      coin.textContent = "ğŸª™";
      coin.style.position = "absolute";
      coin.style.left = pos.left + "px";
      coin.style.top = pos.top + "px";
      coin.style.fontSize = "20px";
      coin.style.cursor = "pointer";
      coin.onclick = () => {
        coins += 25;
        coin.remove();
        updateStats();
      };
      zone.appendChild(coin);
      setTimeout(() => { if (coin.parentElement) coin.remove(); }, 5000);
    }

    function attack() {
      zombies.forEach((zombie, i) => {
        const dx = Math.abs(playerPos.left - zombie.pos.left);
        const dy = Math.abs(playerPos.top - zombie.pos.top);
        if (dx < 50 && dy < 50) {
          if (zombie.type === 'boss') {
            if (!zombie.el.hitCount) zombie.el.hitCount = 1;
            else zombie.el.hitCount++;
            if (zombie.el.hitCount < 3) return;
          }
          if (zombie.type === 'exploder') {
            hp -= 10;
            alert("ğŸ’¥ Portlovchi zombi sizga zarar yetkazdi!");
          }
          dropCoin(zombie.pos);
          zone.removeChild(zombie.el);
          zombies.splice(i, 1);
          xp += 30;
          coins += 50;
          kills++;
          updateStats();
        }
      });
    }

    function useHeal() {
      if (coins >= 50 && hp < 100) {
        hp += 30;
        if (hp > 100) hp = 100;
        coins -= 50;
        updateStats();
      } else alert("ğŸ’Š Dori uchun yetarli coin yoâ€˜q yoki HP toâ€˜liq.");
    }

    function bonusXP() {
      if (coins >= 100) {
        xp += 100;
        coins -= 100;
        updateStats();
      } else alert("âœ¨ Bonus XP uchun coin yetarli emas.");
    }

    function freezeZombies() {
      alert("ğŸ§Š Zombilar 3 soniyaga toâ€˜xtadi!");
      clearInterval(zombieInterval);
      setTimeout(() => {
        zombieInterval = setInterval(moveZombies, 1000);
      }, 3000);
    }

    function zombieMagnet() {
      alert("ğŸ§² Barcha zombilar sizga yaqinlashmoqda!");
      zombies.forEach(z => {
        z.pos.left = playerPos.left + Math.random() * 50;
        z.pos.top = playerPos.top + Math.random() * 50;
        z.el.style.left = z.pos.left + "px";
        z.el.style.top = z.pos.top + "px";
      });
    }

    function upgrade(type) {
      if (coins < 200) {
        alert("ğŸ’° Yetarli coin yoâ€˜q!");
        return;
      }
      coins -= 200;
      if (type === "hp") {
        hp += 20;
        if (hp > 100) hp = 100;
      }
      updateStats();
    }

    function buy(type) {
      if (coins < 100) return alert("ğŸ’¸ Yetarli coin yoâ€˜q!");
      coins -= 100;
      if (type === "heal") useHeal();
      updateStats();
    }

    function toggleProfile() {
      const profile = document.getElementById("profile");
      profile.style.display = profile.style.display === "block" ? "none" : "block";
    }

    function saveProfile() {
      const input = document.getElementById("nickname-input");
      nicknameEl.textContent = input.value || "Anon";
      toggleProfile();
    }

    function saveGame() {
      localStorage.setItem("zombiGame", JSON.stringify({
        hp, xp, coins, kills, level, nickname: nicknameEl.textContent
      }));
    }

    function loadGame() {
      const data = JSON.parse(localStorage.getItem("zombiGame"));
      if (data) {
        hp = data.hp; xp = data.xp; coins = data.coins;
        kills = data.kills; level = data.level;
        nicknameEl.textContent = data.nickname;
        updateStats();
      }
    }

    function showIntro() {
      if (!localStorage.getItem("firstVisit")) {
        alert(`ğŸ‘‹ Assalomu alaykum!
Bu oâ€˜yinda siz mahallani zombi hujumidan himoya qilasiz.
- Har 2 daqiqada yangi turdagi zombi chiqadi.
- Zombilarni oâ€˜ldiring, tajriba oling, doâ€˜konlardan xarid qiling.
Yaxshi oâ€˜yin!`);
        localStorage.setItem("firstVisit", "1");
      }
    }

    // â³ Timer
    let timeLeft = 60;
    const countdownEl = document.getElementById("countdown");
    const timer = setInterval(() => {
      timeLeft--;
      countdownEl.textContent = timeLeft;
      if (timeLeft <= 0) {
        clearInterval(timer);
        alert("â³ Vaqt tugadi! Natijangiz: " + kills + " ta zombi");
      }
    }, 1000);

    // ğŸ” Ishga tushirish
    let zombieInterval, spawnInterval;
    window.onload = () => {
      loadGame();
      updateStats();
      spawnZombie();
      zombieInterval = setInterval(moveZombies, 1000);
      spawnInterval = setInterval(spawnZombie, 3000);
      setInterval(spawnMutantZombie, 2 * 60 * 1000);
      setInterval(() => {
        const box = document.createElement("div");
        box.classList.add("lootbox");
        const pos = {
          top: Math.floor(Math.random() * 600),
          left: Math.floor(Math.random() * 800)
        };
        box.style.top = pos.top + "px";
        box.style.left = pos.left + "px";
        box.onclick = () => {
          coins += 100;
          zone.removeChild(box);
          updateStats();
          alert("ğŸ Lootboxdan 100 coin oldingiz!");
        };
        zone.appendChild(box);
      }, 10000);
      showIntro();
    };

    window.onbeforeunload = saveGame;

    document.addEventListener("keydown", (e) => {
      if (e.key === "w") move("up");
      if (e.key === "a") move("left");
      if (e.key === "s") move("down");
      if (e.key === "d") move("right");
    });
  </script>
</body>
</html>
